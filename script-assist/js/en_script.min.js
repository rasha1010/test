/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
var getUrl = document.location;
var baseUrl = getUrl.origin + '/' + getUrl.pathname.split('/')[0];
var spinner = '<div class="text-center"><img src="' + baseUrl + 'public/templates/website/script-assist/images/loading.svg" width="62"></div>';

var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
});
$(document).ready(function() {
    $('#changeLang').click(function() {
        var url = $(this).attr('rel');
        var data = 'redir=' + url;
        $.ajax({
            type: 'POST',
            data: data,
            url: baseUrl + 'index/change-lang',
            beforeSend: function() {
                $('#changeLang').html('<i class="fas ti-settings fa-spin" style="position: absolute;padding: 5px;"></i>');
            },
            success: function(e) {
                $('#changeLang').html(e);
            }
        });
    });
    return false;
});

function downloadFile(url, filename) {
    var link = document.createElement('a');
    link.href = url;
    link.target = '_blank';
    link.download = filename;
    link.click();
}
$(document).ready(function() {
    function isIos() {
        return /iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    function formatVersionNumber(version) {
        const versionString = String(version);
        if (versionString.indexOf('.') === -1) {
            return versionString + '.0';
        }
        return versionString;
    }

    function createAndShowModal(iosVersion, baseUrl) {
        const formattedVersion = formatVersionNumber(iosVersion);
        document.getElementById("ios-version-span").innerText = formattedVersion;
        const modalElement = document.getElementById('iosProfileInstall');
        const backdropElement = document.getElementById('modal-backdrop');
        modalElement.classList.add('show');
        modalElement.style.display = 'block';
        backdropElement.classList.add('show');
        backdropElement.style.display = 'block';
        const closeButton = document.getElementById('iosProfileInstallModalClose');
        closeButton.addEventListener('click', function() {
            modalElement.style.display = 'none';
            backdropElement.style.display = 'none';
        });
        const closeButtonHeader = document.getElementById('headerIosProfileInstallModalClose');
        closeButtonHeader.addEventListener('click', function() {
            modalElement.style.display = 'none';
            backdropElement.style.display = 'none';
        });
        modalElement.addEventListener('click', function(event) {
            if (event.target === modalElement) {
                modalElement.style.display = 'none';
                backdropElement.style.display = 'none';
            }
        });
    }

    function getIosVersion() {
        if (isIos()) {
            var v = (navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);
            return parseInt(v[1], 10);
        }
        return null;
    }
    $('[id = LoginMember]').on('click', function() {
        if (isIos()) {
            var iosVersion = getIosVersion();
            if (parseFloat(iosVersion) >= 17.0) {
                createAndShowModal(iosVersion, baseUrl);
                var post_link = $(this).attr("target");
                var url = post_link;
                window.location.href = url;
            } else {
                var post_link = $(this).attr("target");
                var settings = $(this).attr('setting-data');
                var url = post_link;
                var url2 = settings;
                window.location.href = url;
                setTimeout(function() {
                    window.location.href = url2;
                }, 1500);
            }
            return false;
        } else {
            swal("Attention!", "It is only allowed to log in through the iPhone and iPad only, and if you are already using an iPhone or iPad, go to Settings and disable the option to request desktop for all sites", "error");
            return false;
        }
    });
});
$('#globalUserProfile').ajaxForm({
    url: baseUrl + 'Members/edit-member-profile',
    type: 'POST',
    beforeSend: function() {
        $('#profileResult').html('<div class="text-center m-t-10">' + spinner + '</div>');
    },
    success: function(e) {
        $('#profileResult').html(e);
    }
});
$('#LoginGlobalFrom').ajaxForm({
    url: baseUrl + 'Members/sgin-in',
    type: 'POST',
    beforeSend: function() {
        $('#loginResult').html('<div class="text-center m-t-10">' + spinner + '</div>');
    },
    success: function(e) {
        $('#loginResult').html(e);
    }
});
$('#forgetPasswordFrom').ajaxForm({
    url: baseUrl + 'Members/forget-password',
    type: 'POST',
    beforeSend: function() {
        $('#loginResult').html('<div class="text-center m-t-10">' + spinner + '</div>');
    },
    success: function(e) {
        $('#loginResult').html(e);
    }
});
$('#resetPasswordFrom').ajaxForm({
    url: baseUrl + 'Members/reset-password',
    type: 'POST',
    beforeSend: function() {
        $('#loginResult').html('<div class="text-center m-t-10">' + spinner + '</div>');
    },
    success: function(e) {
        $('#loginResult').html(e);
    }
});
$('#androidLoginFrom').ajaxForm({
    url: baseUrl + 'Android/sgin-in',
    type: 'POST',
    beforeSend: function() {
        $('#loginResult').html('<div class="text-center m-t-10">' + spinner + '</div>');
    },
    success: function(e) {
        $('#loginResult').html(e);
    }
});
$('#contactUsForm').ajaxForm({
    url: baseUrl + 'Contact_us/save-message',
    type: 'POST',
    beforeSend: function() {
        $('#conReslt').html('<div class="text-center m-t-10">' + spinner + '</div>');
    },
    success: function(e) {
        $('#conReslt').html(e);
    }
});
$('#checkCouponCodeForm').ajaxForm({
    url: baseUrl + 'Coupon_activation/check-coupon',
    type: 'POST',
    beforeSend: function() {
        $('#cResult').html('<div class="text-center m-t-10">' + spinner + '</div>');
    },
    success: function(e) {
        $('#cResult').html(e);
    }
});

$('#payment_method').change(function() {
    var change = $(this).val();
    switch (change) {
        case 'bank':
            $('#westron_tab').hide();
            $('#online_tab').hide();
            $('#paypal_tab').hide();
            $('#walit_tab').hide();
            $('#coupon_tab').hide();
            $('#bank_tab').fadeIn(300);
            $('#westronImage').val(null);
            $('#bankImage').val(null);
            $('#walitImage').val(null);
            break;
        case 'online_link':
            $('#westron_tab').hide();
            $('#bank_tab').hide();
            $('#paypal_tab').hide();
            $('#walit_tab').hide();
            $('#coupon_tab').hide();
            $('#online_tab').fadeIn(300);
            $('#westronImage').val(null);
            $('#bankImage').val(null);
            $('#walitImage').val(null);
            break;
        case 'paypal_me':
            $('#westron_tab').hide();
            $('#bank_tab').hide();
            $('#online_tab').hide();
            $('#walit_tab').hide();
            $('#coupon_tab').hide();
            $('#paypal_tab').fadeIn(300);
            $('#westronImage').val(null);
            $('#bankImage').val(null);
            $('#walitImage').val(null);
            break;
        case 'westron':
            $('#paypal_tab').hide();
            $('#bank_tab').hide();
            $('#online_tab').hide();
            $('#walit_tab').hide();
            $('#coupon_tab').hide();
            $('#westron_tab').fadeIn(300);
            $('#westronImage').val(null);
            $('#bankImage').val(null);
            $('#walitImage').val(null);
            break;
        case 'walit':
            $('#paypal_tab').hide();
            $('#bank_tab').hide();
            $('#online_tab').hide();
            $('#westron_tab').hide();
            $('#coupon_tab').hide();
            $('#walit_tab').fadeIn(300);
            $('#westronImage').val(null);
            $('#bankImage').val(null);
            $('#walitImage').val(null);
            break;
        case 'coupon':
            $('#paypal_tab').hide();
            $('#bank_tab').hide();
            $('#online_tab').hide();
            $('#westron_tab').hide();
            $('#walit_tab').hide();
            $('#coupon_tab').fadeIn(300);
            $('#westronImage').val(null);
            $('#bankImage').val(null);
            $('#walitImage').val(null);
            break;
        default:
            $('#paypal_tab').hide();
            $('#bank_tab').hide();
            $('#online_tab').hide();
            $('#westron_tab').hide();
            $('#walit_tab').hide();
            $('#coupon_tab').hide();
            $('#westronImage').val(null);
            $('#bankImage').val(null);
            $('#walitImage').val(null);
            break;
    }
});